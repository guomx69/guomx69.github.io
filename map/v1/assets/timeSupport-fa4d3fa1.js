import{d2 as C,c8 as j,c9 as P,iM as V,iB as B,bk as J,bd as Z,ck as y,c4 as h,cj as z,at as D,f2 as k,iN as K,iO as L,e4 as Q,iw as N,_ as E,cb as S,iP as b,ca as W,iQ as Y,iR as H,iS as X,iT as tt,dh as A,iU as et,iV as it,q as w,eb as M,b7 as rt}from"./index-cf1f9edc.js";import{f as G,g as F}from"./projectionSupport-aa664e25.js";const nt=new C({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),x=Object.freeze({}),_=new S,st=new S,v=new S,m={esriGeometryPoint:b,esriGeometryPolyline:W,esriGeometryPolygon:Y,esriGeometryMultipoint:H};function Gt(t,e,r,i=t.hasZ,n=t.hasM){if(e==null)return null;const l=t.hasZ&&i,s=t.hasM&&n;if(r){const a=P(v,e,t.hasZ,t.hasM,"esriGeometryPoint",r,i,n);return b(a,l,s)}return b(e,l,s)}function g(t,e,r,i,n,l,s=e,a=r){var R,p,d;const u=e&&s,o=r&&a,c=i!=null?"coords"in i?i:i.geometry:null;if(c==null)return null;if(n){let f=j(st,c,e,r,t,n,s,a);return l&&(f=P(v,f,u,o,t,l)),((R=m[t])==null?void 0:R.call(m,f,u,o))??null}if(l){const f=P(v,c,e,r,t,l,s,a);return((p=m[t])==null?void 0:p.call(m,f,u,o))??null}return V(_,c,e,r,s,a),((d=m[t])==null?void 0:d.call(m,_,u,o))??null}async function It(t,e,r){const{outFields:i,orderByFields:n,groupByFieldsForStatistics:l,outStatistics:s}=t;if(i)for(let a=0;a<i.length;a++)i[a]=i[a].trim();if(n)for(let a=0;a<n.length;a++)n[a]=n[a].trim();if(l)for(let a=0;a<l.length;a++)l[a]=l[a].trim();if(s)for(let a=0;a<s.length;a++)s[a].onStatisticField&&(s[a].onStatisticField=s[a].onStatisticField.trim());return t.geometry&&!t.outSR&&(t.outSR=t.geometry.spatialReference),lt(t,e,r)}async function lt(t,e,r){var l;if(!t)return null;let{where:i}=t;if(t.where=i=i&&i.trim(),(!i||/^1 *= *1$/.test(i)||e&&e===i)&&(t.where=null),!t.geometry)return t;let n=await ot(t);if(t.distance=0,t.units=null,t.spatialRel==="esriSpatialRelEnvelopeIntersects"){const{spatialReference:s}=t.geometry;n=B(n),n.spatialReference=s}if(n){await G(n.spatialReference,r),n=at(n,r);const s=(await J(Z(n)))[0];if(s==null)throw x;const a="quantizationParameters"in t&&((l=t.quantizationParameters)==null?void 0:l.tolerance)||"maxAllowableOffset"in t&&t.maxAllowableOffset||0,u=a&&O(n,r)?{densificationStep:8*a}:void 0,o=s.toJSON(),c=await F(o,o.spatialReference,r,u);if(!c)throw x;c.spatialReference=r,t.geometry=c}return t}function O(t,e){if(!t)return!1;const r=t.spatialReference;return(y(t)||h(t)||z(t))&&!D(r,e)&&!k(r,e)}function at(t,e){const r=t.spatialReference;return O(t,e)&&y(t)?{spatialReference:r,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}:t}async function ot(t){const{distance:e,units:r}=t,i=t.geometry;if(e==null||"vertexAttributes"in i)return i;const n=i.spatialReference,l=r?nt.fromJSON(r):K(n),s=n&&(L(n)||Q(n))?i:await G(n,N).then(()=>F(i,N));return(await ut())(s.spatialReference,s,e,l)}async function ut(){return(await E(()=>import("./geometryEngineJSON-5cdd0d4b.js"),["assets/geometryEngineJSON-5cdd0d4b.js","assets/index-cf1f9edc.js","assets/index-8d370f8c.css","assets/geometryEngineJSON-434198e4.js","assets/json-48e3ea08.js"])).geodesicBuffer}function Nt(t){return t&&T in t?JSON.parse(JSON.stringify(t,ct)):t}const T="_geVersion",ct=(t,e)=>t!==T?e:void 0;function ft(t){return t==="mesh"?X:tt(t)}function U(t,e){return t?e?4:3:e?3:2}function mt(t,e,r,i){return q(t,e,r,i.coords[0],i.coords[1])}function pt(t,e,r,i,n,l){const s=U(n,l),{coords:a,lengths:u}=i;if(!u)return!1;for(let o=0,c=0;o<u.length;o++,c+=s)if(!q(t,e,r,a[c],a[c+1]))return!1;return!0}function q(t,e,r,i,n){if(!t)return!1;const l=U(e,r),{coords:s,lengths:a}=t;let u=!1,o=0;for(const c of a)u=yt(u,s,l,o,c,i,n),o+=c*l;return u}function yt(t,e,r,i,n,l,s){let a=t,u=i;for(let o=i,c=i+n*r;o<c;o+=r){u=o+r,u===c&&(u=i);const R=e[o],p=e[o+1],d=e[u],f=e[u+1];(p<s&&f>=s||f<s&&p>=s)&&R+(s-p)/(f-p)*(d-R)<l&&(a=!a)}return a}const $="feature-store:unsupported-query",Rt={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},I={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};function St(t){return t!=null&&I.spatialRelationship[t]===!0}function dt(t){return t!=null&&I.queryGeometry[rt(t)]===!0}function gt(t){return t!=null&&I.layerGeometry[t]===!0}function ht(){return E(()=>import("./geometryEngineJSON-5cdd0d4b.js"),["assets/geometryEngineJSON-5cdd0d4b.js","assets/index-cf1f9edc.js","assets/index-8d370f8c.css","assets/geometryEngineJSON-434198e4.js","assets/json-48e3ea08.js"])}function At(t,e,r,i,n){if(h(e)&&r==="esriGeometryPoint"&&(t==="esriSpatialRelIntersects"||t==="esriSpatialRelContains")){const l=A(new S,e,!1,!1);return Promise.resolve(s=>mt(l,!1,!1,s))}if(h(e)&&r==="esriGeometryMultipoint"){const l=A(new S,e,!1,!1);if(t==="esriSpatialRelContains")return Promise.resolve(s=>pt(l,!1,!1,s,i,n))}if(y(e)&&r==="esriGeometryPoint"&&(t==="esriSpatialRelIntersects"||t==="esriSpatialRelContains"))return Promise.resolve(l=>et(e,g(r,i,n,l)));if(y(e)&&r==="esriGeometryMultipoint"&&t==="esriSpatialRelContains")return Promise.resolve(l=>it(e,g(r,i,n,l)));if(y(e)&&t==="esriSpatialRelIntersects"){const l=ft(r);return Promise.resolve(s=>l(e,g(r,i,n,s)))}return ht().then(l=>{const s=l[Rt[t]].bind(null,e.spatialReference,e);return a=>s(g(r,i,n,a))})}async function Mt(t,e,r){const{spatialRel:i,geometry:n}=t;if(n){if(!St(i))throw new w($,"Unsupported query spatial relationship",{query:t});if(M(n.spatialReference)&&M(r)){if(!dt(n))throw new w($,"Unsupported query geometry type",{query:t});if(!gt(e))throw new w($,"Unsupported layer geometry type",{query:t});if(t.outSR)return G(t.geometry&&t.geometry.spatialReference,t.outSR)}}}function xt(t){if(y(t))return!0;if(h(t)){for(const e of t.rings)if(e.length!==5||e[0][0]!==e[1][0]||e[0][0]!==e[4][0]||e[2][0]!==e[3][0]||e[0][1]!==e[3][1]||e[0][1]!==e[4][1]||e[1][1]!==e[2][1])return!1;return!0}return!1}async function _t(t,e){if(!t)return null;const r=e.featureAdapter,{startTimeField:i,endTimeField:n}=t;let l=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;if(i&&n)await e.forEach(a=>{const u=r.getAttribute(a,i),o=r.getAttribute(a,n);u==null||isNaN(u)||(l=Math.min(l,u)),o==null||isNaN(o)||(s=Math.max(s,o))});else{const a=i||n;await e.forEach(u=>{const o=r.getAttribute(u,a);o==null||isNaN(o)||(l=Math.min(l,o),s=Math.max(s,o))})}return{start:l,end:s}}function Et(t,e,r){if(!e||!t)return null;const{startTimeField:i,endTimeField:n}=t;if(!i&&!n)return null;const{start:l,end:s}=e;return l===null&&s===null?null:l===void 0&&s===void 0?Pt():i&&n?wt(r,i,n,l,s):$t(r,i||n,l,s)}function wt(t,e,r,i,n){return i!=null&&n!=null?l=>{const s=t.getAttribute(l,e),a=t.getAttribute(l,r);return(s==null||s<=n)&&(a==null||a>=i)}:i!=null?l=>{const s=t.getAttribute(l,r);return s==null||s>=i}:n!=null?l=>{const s=t.getAttribute(l,e);return s==null||s<=n}:void 0}function $t(t,e,r,i){return r!=null&&i!=null&&r===i?n=>t.getAttribute(n,e)===r:r!=null&&i!=null?n=>{const l=t.getAttribute(n,e);return l>=r&&l<=i}:r!=null?n=>t.getAttribute(n,e)>=r:i!=null?n=>t.getAttribute(n,e)<=i:void 0}function Pt(){return()=>!1}export{Gt as G,xt as I,x as M,g as P,Nt as Z,At as a,Mt as b,Et as n,_t as t,It as v,lt as z};
