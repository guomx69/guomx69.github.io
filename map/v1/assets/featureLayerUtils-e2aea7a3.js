import{df as P,gd as A,q as s,_ as g,an as E,aC as l,ge as O,gf as R,gg as j,bn as x,f6 as c,gh as L}from"./index-2e5318f2.js";import q from"./RelationshipQuery-f5f9302c.js";const M=new P({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function G(e,t,n,r){const a=await i(e);if(await h(e,t,r),!a.addAttachment)throw new s(r,"Layer source does not support addAttachment capability");return a.addAttachment(t,n)}function h(e,t,n){const{attributes:r}=t,{objectIdField:a}=e;return e.get("capabilities.data.supportsAttachment")?t?r?a&&r[a]?Promise.resolve():Promise.reject(new s(n,`feature is missing the identifying attribute ${a}`)):Promise.reject(new s(n,"'attributes' are required on a feature to query attachments")):Promise.reject(new s(n,"A feature is required to add/delete/update attachments")):Promise.reject(new s(n,"this layer doesn't support attachments"))}async function $(e,t,n,r,a){const o=await i(e);if(await h(e,t,a),!o.updateAttachment)throw new s(a,"Layer source does not support updateAttachment capability");return o.updateAttachment(t,n,r)}async function V(e,t,n){const{applyEdits:r}=await g(()=>import("./editingSupport-934148c0.js"),["assets/editingSupport-934148c0.js","assets/index-2e5318f2.js","assets/index-dc13cc80.css","assets/EditBusLayer-2916a04f.js"]),a=await e.load();return r(a,a.source,t,n)}async function T(e,t,n){const{uploadAssets:r}=await g(()=>import("./editingSupport-934148c0.js"),["assets/editingSupport-934148c0.js","assets/index-2e5318f2.js","assets/index-dc13cc80.css","assets/EditBusLayer-2916a04f.js"]),a=await e.load();return r(a,a.source,t,n)}async function U(e,t,n,r){const a=await i(e);if(await h(e,t,r),!a.deleteAttachments)throw new s(r,"Layer source does not support deleteAttachments capability");return a.deleteAttachments(t,n)}async function D(e,t,n){const r=(await e.load({signal:t==null?void 0:t.signal})).source;if(!r.fetchRecomputedExtents)throw new s(n,"Layer source does not support fetchUpdates capability");return r.fetchRecomputedExtents(t)}async function Q(e,t,n,r){var w,b;t=E.from(t),await e.load();const a=e.source,o=e.capabilities;if(!((w=o==null?void 0:o.data)!=null&&w.supportsAttachment))throw new s(r,"this layer doesn't support attachments");const{attachmentTypes:p,objectIds:d,globalIds:u,num:I,size:y,start:F,where:m}=t;if(!((b=o==null?void 0:o.operations)!=null&&b.supportsQueryAttachments)&&((p==null?void 0:p.length)>0||(u==null?void 0:u.length)>0||(y==null?void 0:y.length)>0||I||F||m))throw new s(r,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",t);if(!(d!=null&&d.length||u!=null&&u.length||m))throw new s(r,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",t);if(!a.queryAttachments)throw new s(r,"Layer source does not support queryAttachments capability",t);return a.queryAttachments(t)}async function Z(e,t,n,r){const a=await i(e);if(!a.queryObjectIds)throw new s(r,"Layer source does not support queryObjectIds capability");return a.queryObjectIds(l.from(t)??e.createQuery(),n)}async function H(e,t,n,r){const a=await i(e);if(!a.queryFeatureCount)throw new s(r,"Layer source does not support queryFeatureCount capability");return a.queryFeatureCount(l.from(t)??e.createQuery(),n)}async function J(e,t,n,r){const a=await i(e);if(!a.queryExtent)throw new s(r,"Layer source does not support queryExtent capability");return a.queryExtent(l.from(t)??e.createQuery(),n)}async function N(e,t,n,r){const a=await i(e);if(!a.queryRelatedFeatures)throw new s(r,"Layer source does not support queryRelatedFeatures capability");return a.queryRelatedFeatures(q.from(t),n)}async function k(e,t,n,r){const a=await i(e);if(!a.queryRelatedFeaturesCount)throw new s(r,"Layer source does not support queryRelatedFeaturesCount capability");return a.queryRelatedFeaturesCount(q.from(t),n)}async function z(e){const t=e.source;if(t!=null&&t.refresh)try{const{dataChanged:n,updates:r}=await t.refresh();if(r!=null&&(e.sourceJSON={...e.sourceJSON,...r},e.read(r,{origin:"service",url:e.parsedUrl})),n)return!0}catch{}if(e.definitionExpression)try{return(await O(e.definitionExpression,e.fieldsIndex)).hasDateFunctions}catch{}return!1}function B(e){const t=new l,n=e.get("capabilities.data"),r=e.get("capabilities.query");t.historicMoment=e.historicMoment,t.gdbVersion=e.gdbVersion,t.returnGeometry=!0,r&&(t.compactGeometryEnabled=r.supportsCompactGeometry,t.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),n&&(n.supportsZ&&e.returnZ!=null&&(t.returnZ=e.returnZ),n.supportsM&&e.returnM!=null&&(t.returnM=e.returnM)),t.outFields=["*"];const{timeOffset:a,timeExtent:o}=e;return t.timeExtent=a!=null&&o!=null?o.offset(-a.value,a.unit):o||null,t.multipatchOption=e.geometryType==="multipatch"?"xyFootprint":null,t}function K(e){const{globalIdField:t,fields:n}=e;if(t)return t;if(n){for(const r of n)if(r.type==="esriFieldTypeGlobalID")return r.name}}function W(e){const{objectIdField:t,fields:n}=e;if(t)return t;if(n){for(const r of n)if(r.type==="esriFieldTypeOID")return r.name}}function X(e){return e.currentVersion?e.currentVersion:e.hasOwnProperty("capabilities")||e.hasOwnProperty("drawingInfo")||e.hasOwnProperty("hasAttachments")||e.hasOwnProperty("htmlPopupType")||e.hasOwnProperty("relationships")||e.hasOwnProperty("timeInfo")||e.hasOwnProperty("typeIdField")||e.hasOwnProperty("types")?10:9.3}async function i(e){return(await e.load()).source}async function S(e,t){if(!c||c.findCredential(e))return;let n;try{const r=await L(e,t);r&&(n=await c.checkSignInStatus(`${r}/sharing`))}catch{}if(n)try{const r=t!=null?t.signal:null;await c.getCredential(e,{signal:r})}catch{}}async function Y(e,t){var r;const n=(r=e.parsedUrl)==null?void 0:r.path;n&&_(e)&&await S(n,t)}function _(e){const t=e.editFieldsInfo;return!(!(t!=null&&t.creatorField)&&!(t!=null&&t.editorField))||(e.userHasUpdateItemPrivileges?e.hasUpdateItemRestrictions:!!e.userHasFullEditingPrivileges&&e.hasFullEditingRestrictions)}function ee(e){var t;return!((t=e.sourceJSON)!=null&&t.isMultiServicesView)&&(e.userHasUpdateItemPrivileges||e.editingEnabled)}const f=A({types:R});function te(e,t){if(e.defaultSymbol)return e.types&&e.types.length?new j({defaultSymbol:f(e.defaultSymbol,e,t),field:e.typeIdField,uniqueValueInfos:e.types.map(n=>({id:n.id,symbol:f(n.symbol,n,t)}))}):new x({symbol:f(e.defaultSymbol,e,t)})}export{k as A,B as E,H as F,J as I,Y as M,z as O,N as P,ee as Q,W as R,K as S,U as b,M as d,D as g,V as h,Q as j,$ as m,Z as q,te as v,T as w,X as x,G as y};
