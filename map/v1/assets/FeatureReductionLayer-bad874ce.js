import{ah as t,ai as s,al as f,ds as T,gb as R,eH as w,cO as h,fv as z,fy as v,d5 as u,fK as M,fJ as N,fQ as V,bl as E,fR as _,d9 as y,bn as L,gc as k}from"./index-a763570f.js";import{a as g,c as J}from"./clusterUtils-172dfeff.js";import{v as A}from"./featureLayerUtils-f2edf862.js";let c=class extends T{constructor(){super(...arguments),this.type=null}};t([s({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],c.prototype,"type",void 0),c=t([f("esri.layers.support.FeatureReduction")],c);var I;const C="esri.layers.support.FeatureReductionBinning";let a=I=class extends c{constructor(i){super(i),this.type="binning",this.binType="geohash",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}writeFields(i,n,r){const e=i.filter(o=>o.statisticType!=="avg_angle").map(o=>o.toJSON());z(r,e,n)}readRenderer(i,n,r){var o;const e=(o=n.drawingInfo)==null?void 0:o.renderer;return e?v(e,n,r)??void 0:A(n,r)}clone(){return new I({fields:u(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:u(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:u(this.popupTemplate),renderer:u(this.renderer)})}};t([R({binning:"binning"})],a.prototype,"type",void 0),t([R({geohash:"geohash"})],a.prototype,"binType",void 0),t([s({type:Number,range:{min:1,max:9},json:{write:!0}})],a.prototype,"fixedBinLevel",void 0),t([s({type:[M],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],a.prototype,"labelingInfo",void 0),t([s(N)],a.prototype,"labelsVisible",void 0),t([s({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],a.prototype,"maxScale",void 0),t([s(V)],a.prototype,"popupEnabled",void 0),t([s({type:E,json:{name:"popupInfo",write:!0}})],a.prototype,"popupTemplate",void 0),t([s({type:[g],json:{write:!0}})],a.prototype,"fields",void 0),t([w("fields")],a.prototype,"writeFields",null),t([s({types:_,json:{write:{target:"drawingInfo.renderer"}}})],a.prototype,"renderer",void 0),t([h("renderer",["drawingInfo.renderer"])],a.prototype,"readRenderer",null),a=I=t([f(C)],a);const G=a;var x;const D="esri.layers.support.FeatureReductionCluster";function j(i){var n;return i.type==="simple"&&!((n=i.visualVariables)!=null&&n.length)}let l=x=class extends T{constructor(i){super(i),this.type="cluster",this.clusterRadius=y("80px"),this.clusterMinSize=y("12px"),this.clusterMaxSize=y("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}readRenderer(i,n,r){var o,p;const e=(o=n.drawingInfo)==null?void 0:o.renderer;return(p=e==null?void 0:e.authoringInfo)!=null&&p.isAutoGenerated?null:e?j(e)?null:v(e,n,r)??void 0:A(n,r)}readSymbol(i,n,r){var o,p;const e=(o=n.drawingInfo)==null?void 0:o.renderer;if((p=e==null?void 0:e.authoringInfo)!=null&&p.isAutoGenerated)return null;if(e&&j(e)){const d=v(e,n,r);return d==null?void 0:d.symbol}return null}writeSymbol(i,n,r,e){var p,d;const o=(d=(p=this.renderer)==null?void 0:p.authoringInfo)==null?void 0:d.isAutoGenerated;if(!this.renderer||o){const b=new L({symbol:i});n.drawingInfo={renderer:b.write({},e)}}}writeFields(i,n,r){const e=i.filter(o=>o.statisticType!=="avg_angle").map(o=>o.toJSON());z(r,e,n)}readFields(i,n,r){return i.filter(e=>!e.isAutoGenerated).map(e=>g.fromJSON(e))}clone(){return new x({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:u(this.labelingInfo),labelsVisible:this.labelsVisible,fields:u(this.fields),maxScale:this.maxScale,renderer:u(this.renderer),symbol:u(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:u(this.popupTemplate)})}};t([s({type:["cluster"],readOnly:!0,json:{write:!0}})],l.prototype,"type",void 0),t([s({type:Number,cast:i=>i==="auto"?i:y(i),json:{write:!0}})],l.prototype,"clusterRadius",void 0),t([s({type:Number,cast:y,json:{write:!0}})],l.prototype,"clusterMinSize",void 0),t([s({type:Number,cast:y,json:{write:!0}})],l.prototype,"clusterMaxSize",void 0),t([s({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],l.prototype,"maxScale",void 0),t([s(V)],l.prototype,"popupEnabled",void 0),t([s({type:E,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],l.prototype,"popupTemplate",void 0),t([s({types:_,json:{write:{target:"drawingInfo.renderer"}}})],l.prototype,"renderer",void 0),t([h("renderer",["drawingInfo.renderer"])],l.prototype,"readRenderer",null),t([s({types:k})],l.prototype,"symbol",void 0),t([h("symbol",["drawingInfo.renderer"])],l.prototype,"readSymbol",null),t([w("symbol")],l.prototype,"writeSymbol",null),t([s({type:[M],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],l.prototype,"labelingInfo",void 0),t([s(N)],l.prototype,"labelsVisible",void 0),t([s({type:[g],json:{write:!0}})],l.prototype,"fields",void 0),t([w("fields")],l.prototype,"writeFields",null),t([h("fields")],l.prototype,"readFields",null),l=x=t([f(D)],l);const O=l;var S;let m=S=class extends c{constructor(i){super(i),this.type="selection"}clone(){return new S}};t([s({type:["selection"]})],m.prototype,"type",void 0),m=S=t([f("esri.layers.support.FeatureReductionSelection")],m);const $=m,F={key:"type",base:c,typeMap:{cluster:O,binning:G}},H={types:{key:"type",base:c,typeMap:{selection:$,cluster:O,binning:G}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:F},"portal-item":{types:F},"web-scene":{types:{key:"type",base:c,typeMap:{selection:$}}}}}},U=i=>{let n=class extends i{constructor(...r){super(...r),this.own(this.watch("renderer",()=>{if(this.featureReduction){const e=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",e)}},!0))}set featureReduction(r){const e=this._normalizeFeatureReduction(r);this._set("featureReduction",e)}set renderer(r){}_normalizeFeatureReduction(r){var b;if((r==null?void 0:r.type)!=="cluster")return r;const e=r.clone(),o=[new g({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],p=(e.fields??[]).filter(B=>!B.isAutoGenerated);if(r.renderer&&!((b=r.renderer.authoringInfo)!=null&&b.isAutoGenerated))return e.fields=[...o,...p],e;if(r.symbol)return e.fields=[...o,...p],e.renderer=null,e;if(!this.renderer)return r;const d=J(o,this.renderer,r,null,!1);return e.fields=[...o,...p],e.renderer=d,e}};return t([s(H)],n.prototype,"featureReduction",null),n=t([f("esri.layers.mixins.FeatureReductionLayer")],n),n};export{U as n,$ as p,c as t};
